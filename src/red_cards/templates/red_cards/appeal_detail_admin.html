{% extends 'base.html' %}
{% load widget_tweaks %}


{% block content %}
<div class="container">
<nav class="breadcrumb-nav" aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="index.html">Главная</a></li>
    <li class="breadcrumb-item active" aria-current="page">Оспаривание инцидента</li>
  </ol>
</nav>

<h1 class="section-title">Оспаривание инцидента</h1>
<div class="section-block event-block">

  <div class="section-block__item">
    <div class="row align-items-center">
      <div class="col-md-9">

                <div class="user-name">
                  <div class="user-name__value">{{ request.user.get_full_name }}</div>
                    <span class="user-name__id user-id">ID {{ request.user.leader_id }}</span>
                </div>
      </div>
      <div class="col-md-3">
        <div class="user-status">
          <ul class="status-indicator">
            <li><span class="circle circle-orange"></span></li>
            <li><span class="circle circle-orange"></span></li>
            <li><span class="circle circle-orange"></span></li>
            <li><span class="circle"></span></li>
            <li><span class="circle"></span></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="section-block__item" style="background: rgba(173, 130, 130, 0.25);">
    <div class="row align-items-center">

      <div class="col-md-9">
        <div class="user-event">

              <h3 class="user-event__title" style="">
                  {{ card.reason }}
                  {{ card.incident_dt|date:"d.m.Y" }}
              </h3>
              <div class="user-event__date">
                  зафиксировано {{ card.get_status.change_dt|date:"d.m.Y" }}
              </div>
              <p class="user-event__text">
                 {{ card.description }}
              </p>

        </div>

            <div class="event-date">
          {% if appeal.status != appeal.STATUS_APPROVED and appeal.status != appeal.STATUS_REJECTED %}
                 Время до решения:
                <span
                        {% if appeal.time_for_complete > 0 %}
                            style="color: green"
                        {% else %}
                            style="color: darkred"
                        {% endif %}
                >
                {{ appeal.time_for_complete_text }}
                </span>
          {% endif %}
            </div>
      </div>
    </div>

  </div>

  <div class="section-block__item">
    <div class="row align-items-center">
      <div class="col-md-9">

      <div class="form-group">
          {{ appeal.create_dt|date:"d.m.Y" }}
          <p class="user-event__text">
          {{ appeal.description  }}
              </p>
      </div>
          {% if appeal.file %}
      <div class="form-group">
        <div class="custom-file">
            <a href="{{ appeal.file.url }}" download>{{ appeal.file.name  }}</a>
        </div>
      </div>
          {% endif %}
      </div>

            {% include 'red_cards/appeal_status.html' %}

    </div>
  </div>

    {% if request.user == appeal.executive and appeal.status == appeal.STATUS_IN_WORK %}
      <div class="users-list__item">
        <div class="row align-items-center">
          <div class="col-md-6" style="text-align: center;">

                <form action="" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="form_name" value="manage" />

                    <input type="hidden" name="appeal" value="{{ appeal.pk }}" />

                    <button type="submit" name="action" value="accept" class="btn btn-outline-primary" >
                        Одобрить</button>
                    <button type="submit" name="action" value="reject" class="btn btn-outline-primary" style="margin-left: 10px;">
                        Отклонить</button>

                </form>
          </div>
        </div>
      </div>
    {% endif %}
</div>
</div>
{% endblock %}